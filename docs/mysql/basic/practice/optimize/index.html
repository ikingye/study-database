<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="性能优化"><meta property="og:title" content="性能优化" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://ikingye.github.io/study-database/docs/mysql/basic/practice/optimize/" />

<title>性能优化 | 数据库学习笔记</title>
<link rel="icon" href="/study-database/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/study-database/book.min.66d2f6926159dd697150bdcd901eead56a7adc9408513ccb9ab553939262dd4c.css" integrity="sha256-ZtL2kmFZ3WlxUL3NkB7q1Wp63JQIUTzLmrVTk5Ji3Uw=">


<script defer src="/study-database/en.search.min.3944ac34fa7a9320db240de8a6df922a70f3a4a8d556f498ac9d2bb769997efe.js" integrity="sha256-OUSsNPp6kyDbJA3opt&#43;SKnDzpKjVVvSYrJ0rt2mZfv4="></script>

<link rel="alternate" type="application/rss+xml" href="https://ikingye.github.io/study-database/docs/mysql/basic/practice/optimize/index.xml" title="数据库学习笔记" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/study-database"><span>数据库学习笔记</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





  

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/study-database/docs/mysql/" >
      Mysql
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      <span>第一部分 基础入门</span>
    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/study-database/docs/mysql/basic/practice/" >
      最佳实践
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/study-database/docs/mysql/basic/practice/optimize/"  class="active">
      性能优化
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/study-database/docs/mysql/basic/practice/spec/" >
      编程规范
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/study-database/docs/mysql/basic/practice/snippet/" >
      代码片段
  </a>


    

    






  </li>


      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      <span>第二部分 设计</span>
    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      <span>第三部分 源码实现</span>
    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      <span>第四部分 附录</span>
    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/study-database/docs/mysql/appendix/tutorial/" >
      教程
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/study-database/docs/mysql/appendix/interview/" >
      面试题
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/study-database/docs/mysql/appendix/interview/basic/" >
      基础
  </a>

</li>
      
    
      
        <li>

  <a href="/study-database/docs/mysql/appendix/interview/advanced/" >
      进阶
  </a>

</li>
      
    
      
        <li>

  <a href="/study-database/docs/mysql/appendix/interview/expert/" >
      高阶
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/study-database/docs/postgresql/" >
      PostgreSQL
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/study-database/docs/redis/" >
      Redis
  </a>


    

    






  </li>


      
    
  </ul>
  



  











</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/study-database/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>性能优化</strong>

  <label for="toc-control">
    <img src="/study-database/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#mysql-">Mysql 性能优化</a>
      <ul>
        <li><a href="#heading">存储引擎</a>
          <ul>
            <li><a href="#-innodb-">使用 Innodb 存储引擎</a></li>
          </ul>
        </li>
        <li><a href="#heading-1">编码</a>
          <ul>
            <li><a href="#-utf8">统一使用 UTF8</a></li>
          </ul>
        </li>
        <li><a href="#heading-2">表</a>
          <ul>
            <li><a href="#heading-3">控制单表数据量的大小</a></li>
            <li><a href="#-mysql-">谨慎使用 MySQL 分区表</a></li>
            <li><a href="#heading-4">冷热数据分离，减小表的宽度</a></li>
            <li><a href="#heading-5">优先选择小的数据类型</a></li>
            <li><a href="#-not-null">列定义为 NOT NULL</a></li>
          </ul>
        </li>
        <li><a href="#heading-6">索引</a>
          <ul>
            <li><a href="#heading-7">限制每张表上的索引数量</a></li>
            <li><a href="#heading-8">必须有个主键</a></li>
          </ul>
        </li>
        <li><a href="#heading-9">开发</a>
          <ul>
            <li><a href="#heading-10">避免数据类型的隐式转换</a></li>
            <li><a href="#--">避免使用双 % 号的查询条件</a></li>
            <li><a href="#heading-11">联合索引</a></li>
            <li><a href="#-left-join--not-in-">使用 left join 替代 not in 操作</a></li>
          </ul>
        </li>
        <li><a href="#heading-12">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
<article class="markdown"><h1 id="mysql-">Mysql 性能优化</h1>
<h2 id="heading">存储引擎</h2>
<h3 id="-innodb-">使用 Innodb 存储引擎</h3>
<p>没有特殊要求（即 Innodb 无法满足的功能如：列存储，存储空间数据等）的情况下，所有表必须使用 Innodb 存储引擎（MySQL5.5 之前默认使用 Myisam，5.6 以后默认的为 Innodb）。</p>
<p>Innodb 支持事务，支持行级锁，更好的恢复性，高并发下性能更好。</p>
<hr>
<h2 id="heading-1">编码</h2>
<h3 id="-utf8">统一使用 UTF8</h3>
<p>库和表的字符集统一使用 UTF8</p>
<hr>
<h2 id="heading-2">表</h2>
<h3 id="heading-3">控制单表数据量的大小</h3>
<p>建议在 500 万以内。500 万并不是 MySQL 数据库的限制，过大会造成修改表结构，备份，恢复都会有很大的问题。</p>
<p>可以用历史数据归档（应用于日志数据），分库分表（应用于业务数据）等手段来控制数据量大小</p>
<h3 id="-mysql-">谨慎使用 MySQL 分区表</h3>
<p>分区表在物理上表现为多个文件，在逻辑上表现为一个表；</p>
<p>谨慎选择分区键，跨分区查询效率可能更低；</p>
<p>建议采用物理分表的方式管理大数据。</p>
<h3 id="heading-4">冷热数据分离，减小表的宽度</h3>
<blockquote>
<p>MySQL 限制每个表最多存储 4096 列，并且每一行数据的大小不能超过 65535 字节。</p>
</blockquote>
<p>减少磁盘 IO, 保证热数据的内存缓存命中率（表越宽，把表装载进内存缓冲池时所占用的内存也就越大，也会消耗更多的 IO）；</p>
<p>更有效的利用缓存，避免读入无用的冷数据；</p>
<p>经常一起使用的列放到一个表中（避免更多的关联操作）。</p>
<h3 id="heading-5">优先选择小的数据类型</h3>
<p>列的字段越大，建立索引时所需要的空间也就越大，这样一页中所能存储的索引节点的数量也就越少也越少，在遍历时所需要的 IO 次数也就越多，索引的性能也就越差。</p>
<p>如：</p>
<ul>
<li>将 IP 地址转换成整形数据</li>
<li>对于非负型的数据 (如自增 ID, 整型 IP) 来说，要优先使用无符号整型来存储</li>
</ul>
<h3 id="-not-null">列定义为 NOT NULL</h3>
<p>索引 NULL 列需要额外的空间来保存，所以要占用更多的空间。</p>
<p>进行比较和计算时要对 NULL 值做特别的处理。</p>
<hr>
<h2 id="heading-6">索引</h2>
<h3 id="heading-7">限制每张表上的索引数量</h3>
<p>建议单张表索引不超过 5 个
索引并不是越多越好！索引可以提高效率同样可以降低效率。</p>
<p>索引可以增加查询效率，但同样也会降低插入和更新的效率，甚至有些情况下会降低查询效率。</p>
<p>因为 MySQL 优化器在选择如何优化查询时，会根据统一信息，对每一个可以用到的索引来进行评估，以生成出一个最好的执行计划，如果同时有很多个索引都可以用于查询，就会增加 MySQL 优化器生成执行计划的时间，同样会降低查询性能。</p>
<h3 id="heading-8">必须有个主键</h3>
<p>Innodb 是一种索引组织表：数据的存储的逻辑顺序和索引的顺序是相同的。每个表都可以有多个索引，但是表的存储顺序只能有一种。</p>
<p>Innodb 是按照主键索引的顺序来组织表的</p>
<ul>
<li>不要使用更新频繁的列作为主键，不适用多列主键（相当于联合索引）</li>
<li>不要使用 UUID,MD5,HASH, 字符串列作为主键（无法保证数据的顺序增长）</li>
<li>主键建议使用自增 ID 值</li>
</ul>
<hr>
<h2 id="heading-9">开发</h2>
<h3 id="heading-10">避免数据类型的隐式转换</h3>
<h3 id="--">避免使用双 % 号的查询条件</h3>
<h3 id="heading-11">联合索引</h3>
<p>在定义联合索引时，如果 a 列要用到范围查找的话，就要把 a 列放到联合索引的右侧。</p>
<p>一个 SQL 只能利用到复合索引中的一列进行范围查询。如：有 a,b,c 列的联合索引，在查询条件中有 a 列的范围查询，则在 b,c 列上的索引将不会被用到。</p>
<h3 id="-left-join--not-in-">使用 left join 替代 not in 操作</h3>
<p>使用 left join 或 not exists 来优化 not in 操作，因为 not in 也通常会使用索引失效。</p>
<hr>
<h2 id="heading-12">参考</h2>
<ul>
<li><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/database/MySQL%E9%AB%98%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%A7%84%E8%8C%83%E5%BB%BA%E8%AE%AE.md">MySQL 高性能优化规范建议</a></li>
</ul>
</article>
 

      <footer class="book-footer">
        
  <div class="flex justify-between">



  <div>
    
    <a class="flex align-center" href="https://github.com/ikingye/note/commit/7a1451ececa779c2003c6713e965924f6966092f" title='Last modified by yewang | 2020-03-30' target="_blank" rel="noopener">
      <img src="/study-database/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>2020-03-30</span>
    </a>
  </div>



</div>

 
        
  
  <div class="book-comments">
<script src="https://utteranc.es/client.js"
  repo="ikingye/study-database"
  issue-term="pathname"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>

</div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#mysql-">Mysql 性能优化</a>
      <ul>
        <li><a href="#heading">存储引擎</a>
          <ul>
            <li><a href="#-innodb-">使用 Innodb 存储引擎</a></li>
          </ul>
        </li>
        <li><a href="#heading-1">编码</a>
          <ul>
            <li><a href="#-utf8">统一使用 UTF8</a></li>
          </ul>
        </li>
        <li><a href="#heading-2">表</a>
          <ul>
            <li><a href="#heading-3">控制单表数据量的大小</a></li>
            <li><a href="#-mysql-">谨慎使用 MySQL 分区表</a></li>
            <li><a href="#heading-4">冷热数据分离，减小表的宽度</a></li>
            <li><a href="#heading-5">优先选择小的数据类型</a></li>
            <li><a href="#-not-null">列定义为 NOT NULL</a></li>
          </ul>
        </li>
        <li><a href="#heading-6">索引</a>
          <ul>
            <li><a href="#heading-7">限制每张表上的索引数量</a></li>
            <li><a href="#heading-8">必须有个主键</a></li>
          </ul>
        </li>
        <li><a href="#heading-9">开发</a>
          <ul>
            <li><a href="#heading-10">避免数据类型的隐式转换</a></li>
            <li><a href="#--">避免使用双 % 号的查询条件</a></li>
            <li><a href="#heading-11">联合索引</a></li>
            <li><a href="#-left-join--not-in-">使用 left join 替代 not in 操作</a></li>
          </ul>
        </li>
        <li><a href="#heading-12">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
<a href="https://github.com/ikingye/study-database" 
class="github-corner" aria-label="View source on GitHub">
<svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
  <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
  <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
  <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
</svg></a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
</body>

</html>












